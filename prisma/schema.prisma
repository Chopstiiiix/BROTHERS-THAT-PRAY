generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

enum Role {
  USER
  ADMIN
}

model User {
  id             String           @id @default(cuid())
  email          String           @unique
  name           String?
  password       String
  role           Role             @default(USER)
  isActive       Boolean          @default(true)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  prayerRequests PrayerRequest[]
  comments       Comment[]
  prayedFor      PrayedFor[]
  donations      DonationIntent[]

  @@map("users")
}

model InviteCode {
  id        String    @id @default(cuid())
  code      String    @unique
  email     String?
  usedAt    DateTime?
  usedBy    String?
  expiresAt DateTime?
  createdAt DateTime  @default(now())
  createdBy String?

  @@map("invite_codes")
}

model LiveStream {
  id          String   @id @default(cuid())
  embedUrl    String
  title       String?
  description String?
  schedule    String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("livestreams")
}

model Sermon {
  id          String   @id @default(cuid())
  title       String
  description String?
  speaker     String?
  videoUrl    String?
  audioUrl    String?
  thumbnailUrl String?
  date        DateTime
  duration    String?
  tags        String[]
  isPublished Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("sermons")
}

model Event {
  id          String   @id @default(cuid())
  title       String
  description String?
  location    String?
  startDate   DateTime
  endDate     DateTime?
  imageUrl    String?
  isPublished Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("events")
}

model PrayerRequest {
  id          String      @id @default(cuid())
  title       String
  content     String
  isAnonymous Boolean     @default(false)
  isPublic    Boolean     @default(true)
  userId      String
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  comments    Comment[]
  prayedFor   PrayedFor[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@map("prayer_requests")
}

model Comment {
  id              String        @id @default(cuid())
  content         String
  userId          String
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  prayerRequestId String
  prayerRequest   PrayerRequest @relation(fields: [prayerRequestId], references: [id], onDelete: Cascade)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@map("comments")
}

model PrayedFor {
  id              String        @id @default(cuid())
  userId          String
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  prayerRequestId String
  prayerRequest   PrayerRequest @relation(fields: [prayerRequestId], references: [id], onDelete: Cascade)
  createdAt       DateTime      @default(now())

  @@unique([userId, prayerRequestId])
  @@map("prayed_for")
}

model DonationIntent {
  id            String   @id @default(cuid())
  amount        Float
  currency      String   @default("USD")
  status        String   @default("pending")
  userId        String?
  user          User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  email         String?
  name          String?
  message       String?
  stripePaymentId String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("donation_intents")
}
